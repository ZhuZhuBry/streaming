<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Live Audio &amp; Video from Devices</title>
    <link rel="icon" href="data:image/png;base64,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" type="image/png" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      * {
        font-family: monospace;
      }

      body {
        margin: 0;
      }

      main {
      }

      h2, h3, video, .buttons, select, audio {
        width: 80vw;
        min-width: 300px;
        display: flex;
        margin: auto;
      }

      h1 {
        min-width: 300px;
        height: max(10vw, 42px);
        font-size: 25px;
        box-sizing: border-box;
        text-align: center;
        margin: auto;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      summary {
        width: 80vw;
        font-size: 20px;
        min-width: 300px;
        margin: 20px auto;
      }

      h3 {
        margin-bottom: 4px;
      }

      #videoSelect {
        margin-bottom: 16px;
      }

      details {
        margin-bottom: calc(100vh - 20px);
      }

      video {
        margin-bottom: max(5vw, 20px);
      }

      .buttons button {
        background-color: #CD2355;
        border: none;
        border-radius: 8px;
        width: 50%;
        margin: 2%;
        height: 40px;
        font-size: 20px;
      }

      /*main::after {
        background-color: #0F0;
        content: "";
        font-size: 0;
        padding: 0 50vw;
        padding-bottom: 100vh;
      }*/
    </style>
  </head>
  <body>
    <main>
      <h1>Live Video from Devices</h1>
      <video id="video" controls autoplay></video>
      <div class="buttons">
        <button id="startButton">Start</button>
        <button id="stopButton">Stop</button>
      </div>
      <details>
        <summary class="copyh2">Input Options</summary>
        <h3>Camera</h3>
        <select id="videoSelect"></select>
        <h3>Microphone</h3>
        <select id="audioSelect"></select>
      </details>
      <!--<audio id="audio" controls autoplay></audio>-->
    </main>
    <script>
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const video = document.getElementById('video');
        //const audio = document.getElementById('audio');
        const audioSelect = document.getElementById('audioSelect');
        const videoSelect = document.getElementById('videoSelect');
        let mediaStream;

        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i=0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
                }
            return null;
        }

        function eraseCookie(name) {
            document.cookie = name + '=; Max-Age=-99999999;';
        }


        async function getDevices() {
            const devices = await navigator.mediaDevices.enumerateDevices();
            const audioDevices = devices.filter(device => device.kind === 'audioinput');
            const videoDevices = devices.filter(device => device.kind === 'videoinput');

            audioSelect.innerHTML = audioDevices.map(device => `<option value="${device.deviceId}">${device.label}</option>`).join('');
            videoSelect.innerHTML = videoDevices.map(device => `<option value="${device.deviceId}">${device.label}</option>`).join('');

            const savedAudioSource = getCookie('audioSource');
            const savedVideoSource = getCookie('videoSource');

            if (savedAudioSource) {
                audioSelect.value = savedAudioSource;
            }

            if (savedVideoSource) {
                videoSelect.value = savedVideoSource;
            }
        }

        audioSelect.addEventListener('change', () => {
            setCookie('audioSource', audioSelect.value, 7);
        });

        videoSelect.addEventListener('change', () => {
            setCookie('videoSource', videoSelect.value, 7);
        });


        startButton.addEventListener('click', async () => {
            const audioSource = audioSelect.value;
            const videoSource = videoSelect.value;
            mediaStream = await navigator.mediaDevices.getUserMedia({
                audio: { deviceId: audioSource ? { exact: audioSource } : undefined },
                video: { deviceId: videoSource ? { exact: videoSource } : undefined }
            });
            video.srcObject = mediaStream;
            //audio.srcObject = mediaStream;
        });

        stopButton.addEventListener('click', () => {
            if (mediaStream) {
                const tracks = mediaStream.getTracks();
                tracks.forEach(track => track.stop());
                video.srcObject = null;
                //audio.srcObject = null;
            }
        });

        getDevices();
    </script>
  </body>
</html>
